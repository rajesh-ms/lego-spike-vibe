# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: lego-spike-vibe
metadata:
  template: lego-spike-vibe@0.0.1-beta

variables:
  AZURE_ENV_NAME: "{{ .Env.AZURE_ENV_NAME }}"
  AZURE_LOCATION: "{{ .Env.AZURE_LOCATION }}"
  AZURE_SUBSCRIPTION_ID: "{{ .Env.AZURE_SUBSCRIPTION_ID }}"

services:
  web:
    project: "."
    language: ts
    host: containerapp
    docker:
      path: ./Dockerfile
    hooks:
      predeploy:
        windows:
          shell: pwsh
          run: |
            npm ci
            npm run build
    env:
      - name: NEXTAUTH_URL
        value: https://$(web.uri)
      - name: NEXTAUTH_SECRET
        secret: true
      - name: GOOGLE_CLIENT_ID
        secret: true
      - name: GOOGLE_CLIENT_SECRET
        secret: true
      - name: EMAIL_FROM
        value: "LEGO Vibe <no-reply@example.com>"
      - name: GOOGLE_OAUTH_USER
        secret: true
      - name: GOOGLE_OAUTH_CLIENT_ID
        secret: true
      - name: GOOGLE_OAUTH_CLIENT_SECRET
        secret: true
      - name: GOOGLE_OAUTH_REFRESH_TOKEN
        secret: true
      - name: GOOGLE_OAUTH_REDIRECT_URI
        value: https://developers.google.com/oauthplayground
